{% extends "::base.html.twig" %}

{% block title %}{{ title }}{% endblock %}

{% block body %}
    <div class="container">
        <div>
            <form method="post" action="{{ url('wtw_dashboard_show_documents') }}">
                <div class="row">
                    <div>
                        <h1>{{ title }}</h1>
                        <label for="query"><b>Type your query:</b></label>
                    </div>
                    <div>
                        <textarea id="sql" cols="20" rows="5" name="query">{{ default_query }}</textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="span2">
                        <input id="action-save-query" class="btn" type="button" value="Save your query" />
                    </div>
                    <div class="span2">
                        <input class="btn" type="submit" value="Submit your query" />
                    </div>
                </div>
            </form>
            <div class="row">
                <p id="notification" >
                {% if error is defined %}
                {{ error }}
                {% endif %}
                </p>
            </div>
            <div class="row">
                <table class="table table-condensed">
                {% for columns in records %}
                {% if loop.first %}
                <tr>
                    {% for name, value in columns %}
                    {% set starts_with = name|slice(0,4) %}
                    <td>
                    {% if starts_with == "raw_" or
                        starts_with == "pic_" or
                        starts_with == "lnk_" or
                        starts_with == "pre_" %}
                        {{ name[4:] }}
                    {% else  %}
                        {{ name }}
                    {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endif %}
                <tr>
                    {% for name, value in columns %}
                    <td>
                    {% set starts_with = name|slice(0,4) %}
                    {% if starts_with == "raw_" %}
                        {{ value|raw }}
                    {% elseif starts_with == "pic_" %}
                        <img src="{{ value }}" />
                    {% elseif starts_with == "lnk_" %}
                        <a href="{{ value }}">{{ value }}</a>
                    {% elseif starts_with == "pre_" %}
                        <pre>{{ value }}</pre>
                    {% else %}
                        {{ value }}
                    {% endif %}
                    </td>
                    {% else %}
                        {{ columns }}
                    {% endfor %}
                <tr>
                {% endfor %}
                </table>
            </div>
        </div>
    <div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {% javascripts
        '@WTWDashboardBundle/Resources/public/js/dashboard.js'
        output='js/compiled/main_angular.js' %}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    {% stylesheets
        '@WTWDashboardBundle/Resources/public/css/dashboard.css'
        output='css/compiled/stylesheet.css' %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}