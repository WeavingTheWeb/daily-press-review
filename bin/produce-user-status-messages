#/bin/bash

SCREEN_NAME=$1
PROJECT_DIR=/var/deploy/devobs/current
TASK_NAME=produce-user-status-messages

command='source /vagrant/bin/export-config-parameters && \
export OAUTH_TOKEN=`/bin/bash -c "source /vagrant/bin/select-oauth-token"` && \
export OAUTH_SECRET=`/bin/bash -c "source /vagrant/bin/select-oauth-secret"` && \
'$PROJECT_DIR'/app/console weaving-the-web:amqp:produce:user-timeline \
--oauth_token=$OAUTH_TOKEN \
--oauth_secret=$OAUTH_SECRET \
--screen_name='$SCREEN_NAME' \
>> '$PROJECT_DIR'/app/logs/'$TASK_NAME'.out.log 2>> '$PROJECT_DIR'/app/logs/'$TASK_NAME'.error.log'
echo -e "[ executing \"$TASK_NAME\" command ]\n"$command

VAGRANT_LOG=ERROR vagrant ssh -c "/bin/bash -c '"$command"'"
